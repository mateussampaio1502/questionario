<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="imagens/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mediaqueries.css">
    <title>Formulário</title>
    
    <!-- Firebase Conection -->
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
    <script src="../back-end/app.js" type="module"></script>

    <!--SweetAlert2 conection-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>
    <header>
        <h1>ANÁLISE DE POTÊNCIA</h1>
    </header>
    <div class="campo">
        <p>Obrigado por ter chegado até aqui, esta é a etapa mais importante do questionário e será responsável por
            prover as informações mais essenciais da pesquisa. Tente responder com a atenção reforçada, pois esta seção
            exige que lembremos de algumas informações mais detalhadas.</p>
        <p id="obg">* Indica uma pergunta obrigatória</p>
        <p style="color: red;">Lembre-se de salvar seu progresso!</p>
    </div>
    <div class="campo">
        <p class="required">Informe a faixa de utilização para os seguintes equipamentos <strong>em um dia útil comum</strong>:</p>
        <p class="destaque">Clique no eletrodoméstico para marcar/desmarcar todos</p>
        <div class="table">
            <table>
                <thead>
                    <th>Eletrodoméstico</th>
                    <th>00h</th>
                    <th>01h</th>
                    <th>02h</th>
                    <th>03h</th>
                    <th>04h</th>
                    <th>05h</th>
                    <th>06h</th>
                    <th>07h</th>
                    <th>08h</th>
                    <th>09h</th>
                    <th>10h</th>
                    <th>11h</th>
                    <th>12h</th>
                    <th>13h</th>
                    <th>14h</th>
                    <th>15h</th>
                    <th>16h</th>
                    <th>17h</th>
                    <th>18h</th>
                    <th>19h</th>
                    <th>20h</th>
                    <th>21h</th>
                    <th>22h</th>
                    <th>23h</th>
                </thead>
                <tbody id="tbody_eletro">
                    <td>
                        <select name="eletro" onchange="addEletro()" id="eletro" class="eletro">
                            <option value="" selected disabled>Selecione uma opção</option>
                            <option value="Ar-condicionado 9000 BTUS">Ar-condicionado 9000 BTUS</option>
                            <option value="Ar-condicionado 10000 BTUS">Ar-condicionado 10000 BTUS</option>
                            <option value="Ar-condicionado 12000 BTUS">Ar-condicionado 12000 BTUS</option>
                            <option value="Ar-condicionado 18000 BTUS">Ar-condicionado 18000 BTUS</option>
                            <option value="Ar-condicionado 21000 BTUS">Ar-condicionado 21000 BTUS</option>
                            <option value="Ar-condicionado 30000 BTUS">Ar-condicionado 30000 BTUS</option>
                            <option value="Computador">Computador</option>
                            <option value="Consoles de videogame">Consoles de videogame</option>
                            <option value="Freezer">Freezer</option>
                            <option value="Geladeira de 1 porta">Geladeira de 1 porta</option>
                            <option value="Geladeira de 2 portas">Geladeira de 2 portas</option>
                            <option value="Lâmpada fluorescente">Lâmpada fluorescente</option>
                            <option value="Lâmpada incandescente">Lâmpada incandescente</option>
                            <option value="Lâmpada LED">Lâmpada LED</option>
                            <option value="Modem de Wi-Fi">Modem de Wi-Fi</option>
                            <option value="Televisão">Televisão</option>
                            <option value="Ventilador">Ventilador</option>
                            <option value="Ventilador de teto">Ventilador de teto</option>
                        </select>
                    </td>
                    <td class="firstline" colspan="24">Clique no botão para adicionar equipamentos</td>
                </tbody>
            </table>
        </div>
        <button class="add_remove" id="addbutton" onclick="addEletro()">Adicionar eletrônico</button>
        <button class="add_remove" id="removebutton" onclick="removeEletro()">Remover eletrônico</button>
        <button class="add_remove" id="savebutton" onclick="salvarDadosEletro()">Salvar</button>
    </div>
    <div class="campo">
        <p class="required">Informe a faixa de utilização para os seguintes equipamentos <strong>em um fim de semana comum</strong>:</p>
        <p class="destaque">Clique no eletrodoméstico para marcar/desmarcar todos</p>
        <div class="table">
            <table>
                <thead>
                    <tr>
                        <th>Eletrodoméstico</th>
                        <th>00h</th>
                        <th>01h</th>
                        <th>02h</th>
                        <th>03h</th>
                        <th>04h</th>
                        <th>05h</th>
                        <th>06h</th>
                        <th>07h</th>
                        <th>08h</th>
                        <th>09h</th>
                        <th>10h</th>
                        <th>11h</th>
                        <th>12h</th>
                        <th>13h</th>
                        <th>14h</th>
                        <th>15h</th>
                        <th>16h</th>
                        <th>17h</th>
                        <th>18h</th>
                        <th>19h</th>
                        <th>20h</th>
                        <th>21h</th>
                        <th>22h</th>
                        <th>23h</th>
                    </tr>
                </thead>
                <tbody id="tbody_eletro_weekend">
                    <tr>
                        <td>
                            <select name="eletro_weekend" onchange="addEletro_weekend()" id="eletro_weekend" class="eletro">
                                <option value="" selected disabled>Selecione uma opção</option>
                            <option value="Ar-condicionado 9000 BTUS">Ar-condicionado 9000 BTUS</option>
                            <option value="Ar-condicionado 10000 BTUS">Ar-condicionado 10000 BTUS</option>
                            <option value="Ar-condicionado 12000 BTUS">Ar-condicionado 12000 BTUS</option>
                            <option value="Ar-condicionado 18000 BTUS">Ar-condicionado 18000 BTUS</option>
                            <option value="Ar-condicionado 21000 BTUS">Ar-condicionado 21000 BTUS</option>
                            <option value="Ar-condicionado 30000 BTUS">Ar-condicionado 30000 BTUS</option>
                            <option value="Computador">Computador</option>
                            <option value="Consoles de videogame">Consoles de videogame</option>
                            <option value="Freezer">Freezer</option>
                            <option value="Geladeira de 1 porta">Geladeira de 1 porta</option>
                            <option value="Geladeira de 2 portas">Geladeira de 2 portas</option>
                            <option value="Lâmpada fluorescente">Lâmpada fluorescente</option>
                            <option value="Lâmpada incandescente">Lâmpada incandescente</option>
                            <option value="Lâmpada LED">Lâmpada LED</option>
                            <option value="Modem de Wi-Fi">Modem de Wi-Fi</option>
                            <option value="Televisão">Televisão</option>
                            <option value="Ventilador">Ventilador</option>
                            <option value="Ventilador de teto">Ventilador de teto</option>
                            </select>
                        </td>
                        <td class="firstline" colspan="24">Clique no botão para adicionar equipamentos</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button class="add_remove" id="addbutton" onclick="addEletro_weekend()">Adicionar eletrônico</button>
        <button class="add_remove" id="removebutton" onclick="removeEletro_weekend()">Remover eletrônico</button>
        <button class="add_remove" id="savebuttonWeekend" onclick="salvarDadosEletroWeekend()">Salvar</button>
    </div>

    <div class="campo">
        <p class="required">Informe a <strong>carga horária total em 7 dias</strong> de uso considerando os equipamentos a seguir, <strong>tanto para feriados quanto dias úteis</strong>:</p>
        <p style="color: red;">Note que é necessionário clicar em "adicionar" antes de salvar seu progresso!</p>
        <div class="table">
            <table>
                <thead>
                    <tr>
                        <th>Eletrodoméstico</th>
                        <th>Quantidade de eletrodomésticos</th>
                        <th>Tempo de uso semanal</th>
                    </tr>
                </thead>
                <tbody id="tbody_eletro_esp">
                    <tr>
                        <td>
                            <select name="eletro_esp" id="eletro_esp" class="eletro">
                                <option value="" selected disabled>Selecione uma opção</option>
                                <option value="Air fryer">Air fryer</option>
                                <option value="Aspirador de pó">Aspirador de pó</option>
                                <option value="Carregador de celular">Carregador de celular</option>
                                <option value="Carregador de notebook">Carregador de notebook</option>
                                <option value="Chapa">Chapa</option>
                                <option value="Chuveiro elétrico">Chuveiro elétrico</option>
                                <option value="Ferro elétrico">Ferro elétrico</option>
                                <option value="Forno elétrico">Forno elétrico</option>
                                <option value="Grelha elétrica">Grelha elétrica</option>
                                <option value="Impressora">Impressora</option>
                                <option value="Liquidificador">Liquidificador</option>
                                <option value="Microondas">Microondas</option>
                                <option value="Modelador de cabelo">Modelador de cabelo</option>
                                <option value="Secador de cabelo">Secador de cabelo</option>
                            </select>
                        </td>
                        <td>
                            <input type="number" name="qtd" id="qtd">
                        </td>
                        <td>
                            <input type="number" name="hora" id="hora">
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button class="add_remove" id="addbutton" onclick="addEletro_esp()">Adicionar eletrônico</button>
        <button class="add_remove" id="removebutton" onclick="removeEletro_esp()">Remover eletrônico</button>
        <button class="add_remove" id="savebuttonEsp" onclick="salvarDadosEletroEsp()">Salvar</button>
    </div>

    <div class="nav">
        <button onclick="window.location.href='etapa3.html'; salvarDadosEletro(); salvarDadosEletroWeekend(); salvarDadosEletroEsp()">Voltar</button>
        <!-- <button id="addDataBtn" onclick="window.location.href='etapa5.html'">Enviar</button> -->
        
        <button id="addDataBtn">Enviar</button>
    </div>
    <footer>
        <p>Mateus Sampaio &reg;</p>
    </footer>

    <script>
        var count = 1

        function addEletro() {
            count++;
            let tbody = document.getElementById("tbody_eletro");
            let newRow = tbody.insertRow();
            let eletroSelect = document.getElementById("eletro");
            let selectedEletro = eletroSelect.options[eletroSelect.selectedIndex].text;
            let index = eletroSelect.selectedIndex;
            if (index == 0) {
                Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'error',
                    title: 'Operação inválida!',
                    text: 'Escolha uma opção válida!',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
            } else {
                let cell = newRow.insertCell();
                cell.textContent = selectedEletro;
                cell.style.cursor = "pointer";
                cell.addEventListener('click', function() {
                    let checkboxes = newRow.querySelectorAll("input[type='checkbox']");
                    let allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
                    checkboxes.forEach(checkbox => checkbox.checked = !allChecked);
                });

                for (let i = 0; i < 24; i++) {
                    let cell = newRow.insertCell();
                    let check = document.createElement("input");
                    check.type = "checkbox";
                    check.name = `eletro${count}[${i}]`;
                    check.id = `eletro${count}[${i}]`;
                    cell.appendChild(check);
                }
            }
        }

        function removeEletro() {
            var tbody = document.getElementById("tbody_eletro")
            var length = tbody.rows.length

            if (length > 1) {
                tbody.deleteRow(length - 1)
            } else {
                Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'error',
                    title: 'Operação inválida!',
                    text: 'Não há eletrodomésticos para remover!',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
            }
        }

        function addEletro_weekend() {
            count++;
            let tbody = document.getElementById("tbody_eletro_weekend");
            let newRow = tbody.insertRow();
            let eletroSelect = document.getElementById("eletro_weekend");
            let selectedEletro = eletroSelect.options[eletroSelect.selectedIndex].text;
            let index = eletroSelect.selectedIndex;
            if (index == 0) {
                Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'error',
                    title: 'Operação inválida!',
                    text: 'Escolha uma opção válida!',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
            } else {
                let cell = newRow.insertCell();
                cell.textContent = selectedEletro;
                cell.style.cursor = "pointer";
                cell.addEventListener('click', function() {
                    let checkboxes = newRow.querySelectorAll("input[type='checkbox']");
                    let allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
                    checkboxes.forEach(checkbox => checkbox.checked = !allChecked);
                });

                for (let i = 0; i < 24; i++) {
                    let cell = newRow.insertCell();
                    let check = document.createElement("input");
                    check.type = "checkbox";
                    check.name = `eletro_weekend${count}[${i}]`;
                    check.id = `eletro_weekend${count}[${i}]`;
                    cell.appendChild(check);
                }
            }
        }

        function removeEletro_weekend() {
            var tbody = document.getElementById("tbody_eletro_weekend")
            var length = tbody.rows.length

            if (length > 1) {
                tbody.deleteRow(length - 1)
            } else {
                Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'error',
                    title: 'Operação inválida!',
                    text: 'Não há eletrodomésticos para remover!',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
            }
        }

        function addEletro_esp() {
            let tbody = document.getElementById("tbody_eletro_esp")
            let eletroSelect = document.getElementById("eletro_esp")
            let selectedEletro = eletroSelect.options[eletroSelect.selectedIndex].text
            let index = eletroSelect.selectedIndex
            let qtd = Number(document.getElementById("qtd").value)
            let hora = Number(document.getElementById("hora").value)

            if (index == 0 || qtd <= 0 || hora <= 0) {
                Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'error',
                    title: 'Operação inválida!',
                    text: 'Verifique os dados e tente novamente',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
            } else {
                let newRow = tbody.insertRow()
                newRow.insertCell().textContent = selectedEletro
                let qtdCell = newRow.insertCell();
                qtdCell.textContent = qtd;
                let horaCell = newRow.insertCell();
                horaCell.textContent = hora;
            }
        }

        function removeEletro_esp() {
            let tbody = document.getElementById("tbody_eletro_esp")
            let length = tbody.rows.length

            if (length > 1) {
                tbody.deleteRow(length - 1)
            } else {
                Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'error',
                    title: 'Operação inválida!',
                    text: 'Não há eletrodomésticos para remover!',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
            }
        }


        function salvarDadosEletro() {
            let data = [];
            let tbody = document.getElementById("tbody_eletro").rows;
            for (let i = 1; i < tbody.length; i++) {
                let equipamento = tbody[i].cells[0].textContent;
                let horas = [];
                for (let j = 1; j <= 24; j++) {
                    let checkbox = tbody[i].cells[j].querySelector("input[type='checkbox']");
                    horas.push(checkbox.checked);
                }
                data.push({ equipamento: equipamento, horas: horas });
            }
            localStorage.setItem("dados_eletro", JSON.stringify(data));
            Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'success',
                    title: 'Operação bem sucedida!',
                    text: 'Os dados foram salvos com sucesso!',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
        }


        function salvarDadosEletroWeekend() {
            let data_weekend = [];
            let tbody_weekend = document.getElementById("tbody_eletro_weekend").rows;
            for (let i = 1; i < tbody_weekend.length; i++) {
                let equipamento = tbody_weekend[i].cells[0].textContent;
                let horas = [];
                for (let j = 1; j <= 24; j++) {
                    let checkbox = tbody_weekend[i].cells[j].querySelector("input[type='checkbox']");
                    horas.push(checkbox.checked);
                }
                data_weekend.push({ equipamento: equipamento, horas: horas });
            }
            localStorage.setItem("dados_eletro_weekend", JSON.stringify(data_weekend));
            Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'success',
                    title: 'Operação bem sucedida!',
                    text: 'Os dados foram salvos com sucesso!',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
        }

        function salvarDadosEletroEsp() {
            let data_esp = [];
            let tbody_esp = document.getElementById("tbody_eletro_esp").rows;
            for (let i = 1; i < tbody_esp.length; i++) {
                let equipamento = tbody_esp[i].cells[0].textContent;
                let quantidade = tbody_esp[i].cells[1].textContent;
                let tempo = tbody_esp[i].cells[2].textContent;
                data_esp.push({ equipamento: equipamento, quantidade: quantidade, tempo: tempo });
            }
            localStorage.setItem("dados_eletro_esp", JSON.stringify(data_esp));
            let isEmpty = JSON.parse(localStorage.getItem("dados_eletro_esp")).length < 1

            if(!isEmpty){
                Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'success',
                    title: 'Operação bem sucedida!',
                    text: 'Os dados foram salvos com sucesso!',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
            }else{
                Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'error',
                    title: 'Operação bem sucedida!',
                    text: 'Selecione uma opção e CLIQUE em ADICIONAR eletrônico!',
                    showConfirmButton: true,
                    timer: 3000,
                    timerProgressBar: true,
                });
            }

        }


        function carregarDados() {

            let data = JSON.parse(localStorage.getItem("dados_eletro"));
            if (data) {
                let tbody = document.getElementById("tbody_eletro");
                data.forEach(item => {
                    let newRow = tbody.insertRow();
                    newRow.insertCell().textContent = item.equipamento;
                    item.horas.forEach(checked => {
                        let cell = newRow.insertCell();
                        let check = document.createElement("input");
                        check.type = "checkbox";
                        check.checked = checked;
                        cell.appendChild(check);
                    });
                });
            }


            let data_weekend = JSON.parse(localStorage.getItem("dados_eletro_weekend"));
            if (data_weekend) {
                let tbody_weekend = document.getElementById("tbody_eletro_weekend");
                data_weekend.forEach(item => {
                    let newRow = tbody_weekend.insertRow();
                    newRow.insertCell().textContent = item.equipamento;
                    item.horas.forEach(checked => {
                        let cell = newRow.insertCell();
                        let check = document.createElement("input");
                        check.type = "checkbox";
                        check.checked = checked;
                        cell.appendChild(check);
                    });
                });
            }


            let data_esp = JSON.parse(localStorage.getItem("dados_eletro_esp"));
            if (data_esp) {
                let tbody_esp = document.getElementById("tbody_eletro_esp");
                data_esp.forEach(item => {
                    let newRow = tbody_esp.insertRow();
                    newRow.insertCell().textContent = item.equipamento;
                    let qtdCell = newRow.insertCell();
                    qtdCell.textContent = item.quantidade;
                    let horaCell = newRow.insertCell();
                    horaCell.textContent = item.tempo;
                });
            }
            Swal.fire({
                    toast: true,
                    position: 'top',
                    icon: 'success',
                    title: 'Continue de onde parou.',
                    text: 'Seu progresso foi salvo!',
                    showConfirmButton: true,
                    timer: 1500,
                    timerProgressBar: true,
                });
        }

        window.onload = function () {
            carregarDados();
        };

    </script>

</body>

</html>